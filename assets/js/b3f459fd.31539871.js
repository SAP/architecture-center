"use strict";(self.webpackChunksap_architecture_center=self.webpackChunksap_architecture_center||[]).push([[3040],{1027:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/rag-components-d89383c94e3938606fb399833a9dd3f4.svg"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},73985:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"ref-arch/RA0005/retrieval-augmented-generation/id-ra0005-3","title":"Retrieval Augmented Generation (RAG)","description":"Enhance LLM control with Retrieval Augmented Generation (RAG), which integrates external data to reduce hallucinations and improve accuracy across multiple domains without the need for fine-tuning. This approach combines factual data with language knowledge for increased precision.","source":"@site/docs/ref-arch/RA0005/3-retrieval-augmented-generation/readme.md","sourceDirName":"ref-arch/RA0005/3-retrieval-augmented-generation","slug":"/ref-arch/5c9255f84a/3","permalink":"/ref-arch/5c9255f84a/3","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/architecture-center/edit/main/docs/ref-arch/RA0005/3-retrieval-augmented-generation/readme.md","tags":[{"inline":false,"label":"Amazon Web Services","permalink":"/tags/aws","description":"Amazon Web Services (AWS) is a cloud computing platform that provides a wide range of services, including computing power, storage, and databases, to help businesses scale and grow."},{"inline":false,"label":"Microsoft Azure","permalink":"/tags/azure","description":"Azure is a cloud computing platform created by Microsoft. It provides a wide range of cloud services, including those for computing, analytics, storage, and networking. Users can pick and choose from these services to develop and scale new applications, or run existing applications, in the public cloud."},{"inline":false,"label":"Google Cloud Platform","permalink":"/tags/gcp","description":"Google Cloud Platform (GCP) is a suite of cloud computing services provided by Google. It offers a variety of services including computing, data storage, data analytics, and machine learning. GCP enables developers to build, test, and deploy applications on Google\'s highly scalable and reliable infrastructure."},{"inline":false,"label":"Generative AI","permalink":"/tags/genai","description":"Generative AI is a type of AI that is capable of generating new data, such as images, videos, and text, based on the data it has been trained on."}],"version":"current","lastUpdatedBy":"kay-schmitteckert","lastUpdatedAt":1738281600000,"sidebarPosition":1,"frontMatter":{"id":"id-ra0005-3","slug":"/ref-arch/5c9255f84a/3","sidebar_position":1,"sidebar_custom_props":{},"title":"Retrieval Augmented Generation (RAG)","description":"Enhance LLM control with Retrieval Augmented Generation (RAG), which integrates external data to reduce hallucinations and improve accuracy across multiple domains without the need for fine-tuning. This approach combines factual data with language knowledge for increased precision.","keywords":["sap","ai","genai","aws","azure","gcp"],"sidebar_label":"Retrieval Augmented Generation (RAG)","image":"img/logo.svg","tags":["aws","azure","gcp","genai"],"hide_table_of_contents":false,"hide_title":false,"toc_min_heading_level":2,"toc_max_heading_level":4,"draft":false,"unlisted":false,"contributors":["kay-schmitteckert","madankumarpichamuthu"],"last_update":{"author":"kay-schmitteckert","date":"2025-01-31T00:00:00.000Z"}},"sidebar":"refarchSidebar","previous":{"title":"Embeddings & Semantic Search","permalink":"/ref-arch/5c9255f84a/2"},"next":{"title":"Secure connectivity with SAP Private Link service","permalink":"/ref-arch/e79a7b609d"}}');var a=t(74848),r=t(28453);const s=t.p+"reference-architecture-generative-ai-rag-a9c979c826714fbe.drawio",o={id:"id-ra0005-3",slug:"/ref-arch/5c9255f84a/3",sidebar_position:1,sidebar_custom_props:{},title:"Retrieval Augmented Generation (RAG)",description:"Enhance LLM control with Retrieval Augmented Generation (RAG), which integrates external data to reduce hallucinations and improve accuracy across multiple domains without the need for fine-tuning. This approach combines factual data with language knowledge for increased precision.",keywords:["sap","ai","genai","aws","azure","gcp"],sidebar_label:"Retrieval Augmented Generation (RAG)",image:"img/logo.svg",tags:["aws","azure","gcp","genai"],hide_table_of_contents:!1,hide_title:!1,toc_min_heading_level:2,toc_max_heading_level:4,draft:!1,unlisted:!1,contributors:["kay-schmitteckert","madankumarpichamuthu"],last_update:{author:"kay-schmitteckert",date:new Date("2025-01-31T00:00:00.000Z")}},c=void 0,l={},d=[{value:"Architecture",id:"architecture",level:2},{value:"RAG Operations",id:"rag-operations",level:2},{value:"Services &amp; Components",id:"services--components",level:2},{value:"Examples",id:"examples",level:2}];function h(e){const n={a:"a",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{DrawioResources:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("DrawioResources",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"To gain more control over the prompting results of a Large Language Model (LLM) in your application, you can leverage your own specific documents or data using Retrieval Augmented Generation (RAG). Key features of RAG include increased knowledge, as it allows LLMs to provide accurate answers by retrieving up-to-date information from external sources, even if the LLM wasn't trained on that data. RAG also offers flexibility by adapting to different domains, memory efficiency by avoiding model fine-tuning, and higher precision through combining factual data with LLM's language skills. Additionally, it enhances transparency by referencing specific sources for results."}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsx)(i,{drawioFile:s}),"\n",(0,a.jsx)(n.p,{children:"Retrieval Augmented Generation (RAG) is a neural architecture that extends the capabilities of Foundation Models (FMs) or Large Language Models (LLMs) by integrating retrieval mechanisms. These mechanisms allow the model to access external data or text beyond its internal knowledge base, making it adaptable to specific use cases, such as tapping into a customer\u2019s proprietary product database or a curated document set."}),"\n",(0,a.jsx)(n.p,{children:"The main objective of RAG is to enhance response quality by grounding answers in relevant, real-time data, thus minimizing the likelihood of hallucinations often found in LLM outputs."}),"\n",(0,a.jsx)(n.p,{children:"RAG is applied to various tasks, including question answering (Q&A) and knowledge-intensive Natural Language Processing (NLP). It effectively combines retrieval and generation approaches, boosting NLP performance in complex scenarios."}),"\n",(0,a.jsxs)(n.p,{children:["A key feature of RAG is its use of embeddings, which can be stored and efficiently retrieved via SAP HANA Cloud's ",(0,a.jsx)(n.a,{href:"./#vector-engine",children:"Vector Engine"}),". This platform provides comprehensive tools for creating vector-based tables, conducting similarity searches, and applying other vector functions essential for RAG workflows."]}),"\n",(0,a.jsx)(n.p,{children:"A high-level Flow of how Retrieval Augmented Generation (RAG) operates:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Question Encoding"}),": The user submits a question or prompt, which is transformed into a dense vector (embedding) by an embedding model."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Document Retrieval"}),": The embedding is used to query a large corpus of pre-embedded documents via SAP HANA Cloud's Vector Engine. Retrieval typically relies on similarity searches, such as cosine similarity, to identify the top-k most relevant documents or text chunks based on their proximity to the query vector."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Response Generation"}),": The retrieved documents, along with the original question, are fed into a Large Language Model (LLM), which generates a response by synthesizing both the query and the retrieved information."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["For a deeper dive into advanced RAG techniques, explore ",(0,a.jsx)(n.a,{href:"https://community.sap.com/t5/technology-blogs-by-sap/a-guide-to-advanced-rag-techniques-for-success-in-business-landscape/ba-p/13571714",children:"A Guide to Advanced RAG Techniques for Success in Business Landscape"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"rag-operations",children:"RAG Operations"}),"\n",(0,a.jsxs)(n.p,{children:["The below image shows the high level components of a RAG Application\n",(0,a.jsx)(n.img,{alt:"image",src:t(1027).A+"",width:"799",height:"995"})]}),"\n",(0,a.jsx)(n.p,{children:"RAG itself can be analysed under the following subheadings:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Knowledge Ingestion"}),"\n",(0,a.jsx)(n.li,{children:"Knowledge Retrieval"}),"\n",(0,a.jsx)(n.li,{children:"Context Augmentation"}),"\n",(0,a.jsx)(n.li,{children:"Generation"}),"\n",(0,a.jsx)(n.li,{children:"Evaluation"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"image",src:t(74694).A+"",width:"662",height:"1000"})}),"\n",(0,a.jsx)(n.p,{children:"When there is a need for unique features in a RAG application with complex requirements, certain components of a typical RAG application might have to evolve and the need for Advanced RAG features rises."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Knowledge Ingestion"}),"\nThis is the phase where the external documents and the true source documents are collected and processed to enhance the LLM\u2019s knowledge base.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Source and Format"})})," When the source document is unstructured, there could be pre-processing steps needed or there might arise a need for the use of third party document ingestors like ",(0,a.jsx)(n.a,{href:"https://github.com/nlmatics/nlm-ingestor",children:"NLM Ingestor"})," for example.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Preparation"})})," In order to prepare the data for chunking and embedding, a pre-step called prepartion is done. Synthetic Data Generation could be an alternative for situations where data is scarse.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Chunking and Embedding"})})," Custom CAP based application can benefit from the CAP LLM Plugin for efficient and faster development. SAP own RAG solution (work in progress) has detailed guide on grounding and chunking and helper functions to build a complete RAG application."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Knowledge Retrieval"}),"\nIn this phase, the user query triggers the retrieval from the embedding storage based on the implemented search algorithm.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Storage"})})," Advanced requirements could demand the use of ",(0,a.jsx)(n.a,{href:"https://www.youtube.com/watch?v=PQrFjthwOWQ",children:"Knowledge Graph"}),".\n",(0,a.jsx)(n.a,{href:"https://python.langchain.com/v0.2/docs/tutorials/rag/",children:"LangChain"})," also has guidance on best approaches to store the embeddings."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Pre-Retrieval"})})," When there are multiple source documents the intent determination in advanced RAG applications will demand pre-retreival steps like intent classification. Also when handling sensitive data, anonymization is mandatory. The CAP LLM Plugin also supports anonymization."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Search Algorithm"})})," Apart from the standard search algorithms (like Cosine) supported by HANA Vector Engine, custom logic to do Hybrid search for complex requirements is also possible."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Context Augmentation"}),"\nThe context of follow up questions, the length of the context window, and the summarization of the context are some of the steps in this phase."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Context Window"})})," Keeping a tab on the context window ensures that the overall cost of the advanced RAG application doesn't  increase unecessarily. Context is also stored to retrieve the conversation history."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Context Tuning"})})," Maintaining the context for follow-up question to efficiently as well as accurately answer the subsequent questions is part of tuning."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Post Retrieval"})})," Techniques like ",(0,a.jsx)(n.a,{href:"https://cohere.com/rerank",children:"reranking"})," of the retreived results will improve the efficiency of the solution."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Generation"}),"\nThe main part of the RAG core logic is the generation of the response.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Model Parameters"})})," Tuning of the model parameters like temperature and top",(0,a.jsxs)(n.em,{children:["p will significantly alter the quality of the response.\n",(0,a.jsx)(n.strong,{children:"*Prompt Engineering"})," Covered in the basic prompting section above.\n**_Optimization"]}),"** Iterative approach to revisit and redefine each of the RAG application steps to tune the parameters and logic to optimize the solution for accuracy and performance."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Evaluation"}),"\nThe overall quality check of the RAG solution is carried out in this step. The quality in terms of performance, correctness, cost effectiveness are all included.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Preparation"})})," Prepare for this phase by zero-ing in on the desired metrics by reviewing the logs. ",(0,a.jsx)(n.a,{href:"https://ai-core-calculator.cfapps.eu10.hana.ondemand.com/uimodule/index.html",children:"Cost Calculator"})," is a handy tool to convert token size to CU and further to monthly cost in $.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Metrics"})})," The ",(0,a.jsx)(n.a,{href:"https://docs.ragas.io/en/latest/concepts/metrics/index.html",children:"major available metrics"})," to measure each segment of a RAG application are to be reviewed and identified specific to the current use case.\n",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.em,{children:"Action"})})," Following the recommended Reference Architecture patterns, reviewing and adhering to suggestions from ACDs and ADRs, reacting to the measured metrics - are some of the possible actions to mature the RAG application and to get it production ready"]}),"\n",(0,a.jsx)(n.h2,{id:"services--components",children:"Services & Components"}),"\n",(0,a.jsxs)(n.p,{children:["For a comprehensive list of services, components and descriptions, please explore the Introduction on ",(0,a.jsx)(n.a,{href:"./#services--components",children:"Services & Components"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.p,{children:"Take a look at the following examples that build upon or implement elements of the Reference Architecture:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://discovery-center.cloud.sap/missiondetail/4371/",children:"GenAI Mail Insights: Develop a CAP-based (multitenant) application using GenAI and Retrieval Augmented Generation (RAG)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/SAP-samples/cap-llm-plugin-samples/tree/main/samples/rag-quickstart-app",children:"RAG Quickstart using CAP LLM Plugin"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},74694:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/rag-development-0a58035e42ded1e03bf7c30b7181adf0.svg"}}]);