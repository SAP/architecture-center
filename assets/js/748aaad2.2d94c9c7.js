"use strict";(self.webpackChunksap_architecture_center=self.webpackChunksap_architecture_center||[]).push([[6831],{28453:(e,i,a)=>{a.d(i,{R:()=>r,x:()=>o});var n=a(96540);const t={},s=n.createContext(t);function r(e){const i=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(s.Provider,{value:i},e.children)}},78156:(e,i,a)=>{a.r(i),a.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"ref-arch/RA0007/mt-architecture/id-ra0007-4","title":"Reference Architecture","description":"Reference Architecture","source":"@site/docs/ref-arch/RA0007/5-mt-architecture/readme.md","sourceDirName":"ref-arch/RA0007/5-mt-architecture","slug":"/ref-arch/e7724ef4a7/4","permalink":"/ref-arch/e7724ef4a7/4","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/architecture-center/edit/main/docs/ref-arch/RA0007/5-mt-architecture/readme.md","tags":[{"inline":false,"label":"Application Development & Automation","permalink":"/tags/appdev","description":"Extend, create, and automate apps for SAP and non-SAP solutions."},{"inline":false,"label":"CAP","permalink":"/tags/cap","description":"SAP Cloud Application Programming Model (CAP) is a framework of languages, libraries, and tools for building enterprise-grade services and applications. It guides developers along a path of proven best practices and a great wealth of out-of-the-box solutions to recurring tasks."},{"inline":false,"label":"Generative AI","permalink":"/tags/genai","description":"Generative AI is a type of AI that is capable of generating new data, such as images, videos, and text, based on the data it has been trained on."}],"version":"current","lastUpdatedBy":"Ajit Kumar Panda","lastUpdatedAt":1738281600000,"sidebarPosition":1,"frontMatter":{"id":"id-ra0007-4","slug":"/ref-arch/e7724ef4a7/4","sidebar_position":1,"sidebar_custom_props":{},"title":"Reference Architecture","description":"Reference Architecture","keywords":["sap","btp","multitenant","saas","cap"],"sidebar_label":"Reference Architecture","image":"img/logo.svg","tags":["appdev","cap","genai"],"hide_table_of_contents":false,"hide_title":false,"toc_min_heading_level":2,"toc_max_heading_level":4,"draft":false,"unlisted":false,"contributors":["AjitKP91","alperdedeoglu"],"last_update":{"author":"Ajit Kumar Panda","date":"2025-01-31T00:00:00.000Z"}},"sidebar":"refarchSidebar","previous":{"title":"Tenant Lifecycle Management","permalink":"/ref-arch/e7724ef4a7/3"},"next":{"title":"Cost of Ownership","permalink":"/ref-arch/e7724ef4a7/5"}}');var t=a(74848),s=a(28453);const r=a.p+"susaas-app-architecture-7660296ed96a7e1e.drawio",o={id:"id-ra0007-4",slug:"/ref-arch/e7724ef4a7/4",sidebar_position:1,sidebar_custom_props:{},title:"Reference Architecture",description:"Reference Architecture",keywords:["sap","btp","multitenant","saas","cap"],sidebar_label:"Reference Architecture",image:"img/logo.svg",tags:["appdev","cap","genai"],hide_table_of_contents:!1,hide_title:!1,toc_min_heading_level:2,toc_max_heading_level:4,draft:!1,unlisted:!1,contributors:["AjitKP91","alperdedeoglu"],last_update:{author:"Ajit Kumar Panda",date:new Date("2025-01-31T00:00:00.000Z")}},c=void 0,l={},d=[{value:"Architecture",id:"architecture",level:2},{value:"Key Services and Components",id:"key-services-and-components",level:3},{value:"Cloud Application Programming Model (CAP)",id:"cloud-application-programming-model-cap",level:4},{value:"@sap/cds-mtxs package",id:"sapcds-mtxs-package",level:5},{value:"Standalone App Router vs SAP Build WorkZone, Standard Edition",id:"standalone-app-router-vs-sap-build-workzone-standard-edition",level:4},{value:"SAP Software-as-a-Service Provisioning Service",id:"sap-software-as-a-service-provisioning-service",level:4},{value:"Custom Domain Service",id:"custom-domain-service",level:4},{value:"API Service Broker",id:"api-service-broker",level:4},{value:"Workflows",id:"workflows",level:2},{value:"SaaS Application Flow",id:"saas-application-flow",level:3},{value:"SaaS Service API Flow",id:"saas-service-api-flow",level:3},{value:"Resources",id:"resources",level:2},{value:"Related Missions",id:"related-missions",level:2}];function p(e){const i={a:"a",admonition:"admonition",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components},{DrawioResources:a}=i;return a||function(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("DrawioResources",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"/ref-arch/e7724ef4a7#overview",children:"Multitenancy"})," is an important architectural concept used in SaaS application development in which a single instance of an application serves multiple customers (tenants). Multiple customers share computing resources that are logically separated. Each tenant is logically separated and operates as if they have their own isolated environment, even though they share the same underlying resources, such as the application itself, databases, and infrastructure."]}),"\n",(0,t.jsxs)(i.p,{children:["This reference architecture is a comprehensive architecture designed to guide developers, partners, and customers in building multitenant SaaS applications using the ",(0,t.jsx)(i.a,{href:"https://cap.cloud.sap/docs/",children:"SAP Cloud Application Programming Model (CAP)"}),". This demonstrates the development and deployment of a multitenant application on SAP BTP with integration to multiple BTP services and business systems like SAP S/4HANA leveraging both Cloud Foundry and Kyma runtimes."]}),"\n",(0,t.jsx)(i.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(a,{drawioFile:r}),"\n",(0,t.jsx)(i.h3,{id:"key-services-and-components",children:"Key Services and Components"}),"\n",(0,t.jsx)(i.p,{children:"The following sections describe the essential components and services that form the architecture."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.h4,{id:"cloud-application-programming-model-cap",children:"Cloud Application Programming Model (CAP)"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.a,{href:"https://cap.cloud.sap/docs/",children:"SAP Cloud Application Programming Model (CAP)"})," is a framework of languages, libraries, and tools for building enterprise-grade services and applications. It supports Java (with Spring Boot), JavaScript, and TypeScript (with Node.js), which are some of the most widely adopted languages.\nCAP is recommended by the ",(0,t.jsx)(i.a,{href:"https://help.sap.com/docs/btp/btp-developers-guide/",children:"SAP BTP Developer's Guide"}),", guides developers along a path of proven best practices and a great wealth of out-of-the-box solutions to recurring tasks. CAP has built-in support for multitenancy with the MTXs package."]}),"\n",(0,t.jsx)(i.h5,{id:"sapcds-mtxs-package",children:(0,t.jsx)(i.a,{href:"https://www.npmjs.com/package/@sap/cds-mtxs",children:"@sap/cds-mtxs package"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"It provides a set of services that implement multitenancy, features toggles, and extensibility (\u2018MTX\u2019 stands for these three features)."}),"\n",(0,t.jsx)(i.li,{children:"It offers an easy way to integrate dependent services such as SAP SaaS Provisioning Service, SAP Service Manager, User Account and Authentication Service etc. into the CAP application."}),"\n",(0,t.jsx)(i.li,{children:"CAP includes these MTX services, which provide out-of-the-box handlers for subscribe/unsubscribe events, for example to manage SAP HANA database containers."}),"\n",(0,t.jsx)(i.li,{children:"Also supports addition of custom logic within handlers of for subscribe/unsubscribe events. For example, you can create custom handlers to manage the subscribe events, such as creating a destination for connecting to business systems like SAP S/4HANA, assigning roles, setting up routes in Cloud Foundry, defining api rules in Kyma, or creating SAP BTP service instances."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"In the provided Reference Architecture, CAP serves as the central hub for application and domain logic, providing multitenancy, interacting with SAP Solutions (Cloud or On-Premise), 3rd party applications, and managing data sources such as SAP HANA Cloud."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.h4,{id:"standalone-app-router-vs-sap-build-workzone-standard-edition",children:"Standalone App Router vs SAP Build WorkZone, Standard Edition"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.em,{children:"Guidance and TradeOffs To be updated based on Analysis"})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.h4,{id:"sap-software-as-a-service-provisioning-service",children:"SAP Software-as-a-Service Provisioning Service"}),"\n",(0,t.jsx)(i.p,{children:"SAP Software-as-a-Service Provisioning service helps manage and automate the subscription lifecycle of multitenant applications on SAP BTP. It provides apis for registering, subscribing, and managing SaaS applications and tenants. Key feature of the service includes:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Subscription Management: enables subscribing and unsubscribing tenants to multitenant applications and services."}),"\n",(0,t.jsx)(i.li,{children:"Registration Details: retrieves details of registered multitenant applications."}),"\n",(0,t.jsx)(i.li,{children:"Subscription Information: provides information on current subscriptions, including tenant ids and dependencies."}),"\n",(0,t.jsx)(i.li,{children:"Dependency Management: allows updating services that a multitenant application depends on."}),"\n",(0,t.jsx)(i.li,{children:"Job Information: tracks the status of subscription-related operations, like subscribing, unsubscribing, or updating dependencies. In short, this service manages the lifecycle of multitenant applications, including tenant subscription, registration, dependency updates, and related job status tracking."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"The SaaS provider deploys the multitenant application to the provider subaccount. The application is then registered with the SAP Software-as-a-Service Provisioning service, which makes the application available in service marketplace for subscription from consumer subaccount. Subsequently the consumer subaccounts subscribe to the SaaS application."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.h4,{id:"custom-domain-service",children:"Custom Domain Service"}),"\n",(0,t.jsxs)(i.p,{children:['The SAP Custom Domain service allows you to configure a custom domain for your application, enabling you to publicly expose it under your own domain name instead of the default subdomain. By using this service, subaccount owners can make their SAP BTP applications accessible via a custom domain that is different from the default "hana.ondemand.com", for example - "mysaasshop.com". For more information on features of this service, refer to the ',(0,t.jsx)(i.a,{href:"https://help.sap.com/docs/custom-domain/custom-domain-manager/what-is-custom-domain#features",children:"SAP Custom Domain service features documentation"})]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.h4,{id:"api-service-broker",children:"API Service Broker"}),"\n",(0,t.jsxs)(i.p,{children:["Service Broker acts as an intermediary between a platform and a service provider. It is responsible for advertising a catalog of service offerings and service plans to the platform. It also handle the provisioning, binding, unbinding, and deprovisioning of service instances in a standardized way such as ",(0,t.jsx)(i.a,{href:"https://github.com/openservicebrokerapi/servicebroker",children:"Open Service Broker API (OSBAPI)"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["In the provided reference architecture, a Node.js based api broker application is deployed using ",(0,t.jsx)(i.em,{children:(0,t.jsx)(i.em,{children:"@sap/sbf"})})," npm package that acts as a Service Broker with OSBAPI based interface. It used the This Service Broker needs to be registered in each consumer subaccount which can be automated during subscription of SaaS application. For more information this topic, refer to the documentation: ",(0,t.jsx)(i.a,{href:"https://github.com/SAP-samples/btp-cap-multitenant-saas/blob/f207ade3654574dd2fd34196656bedc1a74a7a4d/docu/2-basic/7-explore-the-components/components/ServiceBrokers.md#36-registering-to-service-broker",children:"Deep Dive into Service Brokers"})]}),"\n",(0,t.jsxs)(i.admonition,{title:"@sap/sbf",type:"info",children:[(0,t.jsx)(i.p,{children:"A Node.js framework to create a service broker in SAP Business Technology Platform (SAP BTP)"}),(0,t.jsx)(i.p,{children:"The Service Broker Framework (SBF) implements the Open Service Broker API. It can be used in the Cloud Foundry Kyma environments of SAP BTP. SBF can generate service credentials using XSUAA broker plan."})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"workflows",children:"Workflows"}),"\n",(0,t.jsxs)(i.p,{children:["This ",(0,t.jsx)(i.a,{href:"/ref-arch/e7724ef4a7/4#architecture",children:"reference architecture"})," supports both multitenant SaaS application and SaaS Service api workflows. For this context, we will define a SaaS application as a fully functional software solution with a dedicated user interface that allows application users to perform tasks, manage data, or execute business processes. A SaaS Service api, on the other hand, is an interface that enables external systems, applications, or services to interact programmatically with the SaaS application."]}),"\n",(0,t.jsx)(i.h3,{id:"saas-application-flow",children:"SaaS Application Flow"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"For each customer, a subaccount (consumer subaccount) is created, and an instance of the SaaS application is subscribed, triggering the subscription process via SAP SaaS Provisioning Service."}),"\n",(0,t.jsx)(i.li,{children:"During this process, the CAP framework creates a HANA HDI container instance via the SAP Service Manager, which can be extended with creation of specific services or components of the SaaS application, such as identity provider instance integration or SaaS Service api broker registration. Upon successful subscription, a unique  URL is provided for each customer."}),"\n",(0,t.jsx)(i.li,{children:"As part of the application setup, destinations can be configured in the consumer subaccount to connect to SAP systems or third-party systems, if needed. Additionally, one consumer admin user is added by the SaaS provider, who can then add more users and assign roles as needed for accessing the SaaS application."}),"\n",(0,t.jsx)(i.li,{children:"Users can access the SaaS application via the unique URL, which redirects them for authentication to cloud identity services. Once logged in, the SaaS application (UI component) is loaded based on the user's authorization."}),"\n",(0,t.jsx)(i.li,{children:"In the SaaS application, data is loaded from the CAP based SaaS business application service, which retrieves data from the HANA HDI container instance created during subscription, as well as from SAP systems or third-party systems using destinations configured in the consumer subaccount via the Destination Service. Additionally, SaaS business application service handles all the business process related functionalities."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"saas-service-api-flow",children:"SaaS Service API Flow"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"The Service Broker is automatically registered in the consumer subaccount during the subscription/provisioning process. Note that roles can be assigned and/or features can be enabled/disabled according to the plans of service defined in api broker."}),"\n",(0,t.jsx)(i.li,{children:"Then, a new Service Binding is created which will provide necessary credentials to call CAP based SaaS API service that can be used by API clients. It allows consumers to interact programmatically with their data stored in specific HDI containers. Additionally, SaaS API Service can handle business related functionalities as well."}),"\n",(0,t.jsxs)(i.li,{children:["Depending on the plan, different API policies, such as rate limiting, maximum body content, and quota policies, can be applied using the ",(0,t.jsx)(i.a,{href:"https://help.sap.com/docs/integration-suite/sap-integration-suite/api-management-capability",children:"SAP API Management capability of the SAP Integration Suite"})," on SAP BTP."]}),"\n",(0,t.jsx)(i.li,{children:"This also allows to push business data from SAP systems such as SAP S/4HANA to the multitenant SaaS application."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://cap.cloud.sap/docs/",children:"SAP Cloud Application Programming Model"})," and ",(0,t.jsx)(i.a,{href:"https://cap.cloud.sap/docs/guides/multitenancy/",children:"Multitenancy"})]}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/SAP-samples/btp-cap-multitenant-saas/tree/main",children:"Reference Application : SAP Samples | GitHub "})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://help.sap.com/docs/btp/sap-business-technology-platform/developing-multitenant-applications-in-cloud-foundry-environment",children:"Developing Multitenant Applications in the Cloud Foundry Environment"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://help.sap.com/docs/custom-domain/custom-domain-manager/configuring-custom-domains",children:"Configuring Custom Domains"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/SAP-samples/btp-cap-multitenant-saas/blob/f207ade3654574dd2fd34196656bedc1a74a7a4d/docu/3-advanced/4-cf-integrate-api-management/README.md",children:"Connect Cloud Foundry with SAP API Management"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://github.com/SAP-samples/btp-cap-multitenant-saas/blob/f207ade3654574dd2fd34196656bedc1a74a7a4d/docu/3-advanced/4-kyma-integrate-api-management/README.md",children:"Integrate Kyma with SAP API Management"})}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"related-missions",children:"Related Missions"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://discovery-center.cloud.sap/missiondetail/4064/",children:"Develop a multitenant SaaS application on SAP BTP using CAP"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://discovery-center.cloud.sap/missiondetail/4371/",children:"Develop a CAP-based (multitenant) application using GenAI and RAG"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}}}]);